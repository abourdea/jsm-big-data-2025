---
title: "Practice a Smooth Workflow"
editor: source
---

## Setup


## Your Turn

The following pipeline is disorganized, syntactically inconsistent, and of course, slow.

Rewrite it using your new skills to be clean, readable, and efficient.

Then use your favorite benchmarking or speed testing approach from unit 1 to demonstrate that the new pipeline is indeed faster.

```{r}
#| eval: false

states <- c("ak", "al", "ar", "az", "wa", "wi", "wv", "wy")

dat <- data.frame()

for (state in states) {
  my_files <- list.files(glue::glue("./materials/data/raw_csvs/person/2021/{state}/"), full.names = TRUE)
  
  for (file in my_files) {
    
    temp <- read_csv(file) |>
      mutate_all(as.character)
    
    dat <- dat |>
      bind_rows(temp)
    
  }
}


dat[year == 2021][, .(avg_age = mean(AGEP)), by = ST][order(-avg_age)]



dat |>
  group_by(location) |>
  summarize(
    max_commute = max(JWMNP, na.rm = TRUE),
    min_commute = min(JWMNP, na.rm = TRUE)
  ) |> 
  pivot_longer(!location, names_to = "commute_metric", values_to = "time") |>
  arrange(location) 
```

